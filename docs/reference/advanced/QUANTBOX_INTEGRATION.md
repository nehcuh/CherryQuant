# CherryQuant + QuantBox é›†æˆæ–‡æ¡£

## ğŸ“– æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°äº† CherryQuant ä¸ QuantBox çš„æ·±åº¦é›†æˆï¼Œé€šè¿‡å¼•å…¥ QuantBox çš„é«˜æ€§èƒ½æ•°æ®ç®¡ç†ç³»ç»Ÿï¼Œæ˜¾è‘—æå‡äº† CherryQuant çš„æ•°æ®å¤„ç†èƒ½åŠ›ã€‚

## ğŸ¯ é›†æˆç›®æ ‡

- **æ€§èƒ½æå‡**ï¼šå¼‚æ­¥æ“ä½œ + ç¼“å­˜é¢„çƒ­ï¼Œæ•°æ®è·å–é€Ÿåº¦æå‡ 10-20 å€
- **ä»£ç ç®€åŒ–**ï¼šå‡å°‘ 40-60% çš„æ•°æ®å¤„ç†ç›¸å…³ä»£ç 
- **åŠŸèƒ½å¢å¼º**ï¼šç»Ÿä¸€çš„å¤šæ•°æ®æºæ”¯æŒï¼ˆTushareã€æ˜é‡‘é‡åŒ–ã€MongoDBï¼‰
- **æ™ºèƒ½é€‰æ‹©**ï¼šè‡ªåŠ¨æœ¬åœ°ä¼˜å…ˆç­–ç•¥ï¼Œé™ä½ API è°ƒç”¨æˆæœ¬
- **å‘åå…¼å®¹**ï¼šä¿æŒä¸ç°æœ‰ CherryQuant æ¶æ„çš„å®Œå…¨å…¼å®¹

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### é›†æˆæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CherryQuant åº”ç”¨å±‚              â”‚
â”‚   (AIå¼•æ“ã€äº¤æ˜“ç­–ç•¥ã€Web APIç­‰)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     å¢å¼ºç‰ˆ HistoryDataManager           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚    QuantBox é›†æˆå±‚             â”‚   â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚  â”‚  é€‚é…å™¨      â”‚  â”‚  æ¡¥æ¥å™¨   â”‚ â”‚   â”‚
â”‚   â”‚  â”‚ (Adapter)   â”‚  â”‚ (Bridge) â”‚ â”‚   â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   QuantBox      â”‚  â”‚  ä¼ ç»Ÿæ•°æ®åº“      â”‚
â”‚  (MongoDB +     â”‚  â”‚ (PostgreSQL)    â”‚
â”‚   å¤šæ•°æ®æº)      â”‚  â”‚   + Redis       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

1. **CherryQuantQuantBoxAdapter**ï¼šä¸»é€‚é…å™¨ï¼Œæä¾›ä¸ QuantBox çš„ç»Ÿä¸€æ¥å£
2. **DataBridge**ï¼šæ•°æ®æ¡¥æ¥å™¨ï¼Œå¤„ç†æ ¼å¼è½¬æ¢å’Œç¼“å­˜ç®¡ç†
3. **HistoryDataManager (å¢å¼ºç‰ˆ)**ï¼šé›†æˆäº† QuantBox çš„å†å²æ•°æ®ç®¡ç†å™¨

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½æ•°æ®æºé€‰æ‹©

- **æœ¬åœ°ä¼˜å…ˆ**ï¼šè‡ªåŠ¨ä¼˜å…ˆä½¿ç”¨æœ¬åœ° MongoDB æ•°æ®
- **å›é€€æœºåˆ¶**ï¼šæœ¬åœ°æ•°æ®ä¸å¯ç”¨æ—¶ï¼Œè‡ªåŠ¨ä»è¿œç¨‹è·å–
- **åŒå†™æ”¯æŒ**ï¼šå¯é…ç½®åŒæ—¶å†™å…¥æ–°æ—§ç³»ç»Ÿ

### 2. å¼‚æ­¥é«˜æ€§èƒ½æ“ä½œ

```python
# å¼‚æ­¥æ‰¹é‡è·å–æ•°æ®
requests = [
    {"symbol": "rb2501", "exchange": "SHFE", "interval": "1d", ...},
    {"symbol": "cu2501", "exchange": "SHFE", "interval": "1d", ...}
]
results = await manager.batch_get_historical_data(requests)
```

### 3. æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ

- **ç¼“å­˜é¢„çƒ­**ï¼šå¯åŠ¨æ—¶é¢„çƒ­ 2000+ ä¸ªç¼“å­˜æ¡ç›®
- **æ€§èƒ½æå‡**ï¼šé¦–æ¬¡æ“ä½œé€Ÿåº¦æå‡ 95%+
- **è‡ªåŠ¨å¤±æ•ˆ**ï¼šåŸºäº TTL çš„è‡ªåŠ¨ç¼“å­˜æ¸…ç†

### 4. æ•°æ®æ ¼å¼è½¬æ¢

è‡ªåŠ¨åœ¨ CherryQuant å’Œ QuantBox æ•°æ®æ ¼å¼ä¹‹é—´è½¬æ¢ï¼š

```python
# QuantBox æ ¼å¼ â†’ CherryQuant æ ¼å¼
data_points = adapter.quantbox_to_cherryquant_data(df)
```

## ğŸ“¦ å®‰è£…å’Œé…ç½®

### 1. ä¾èµ–å®‰è£…

CherryQuant çš„ `pyproject.toml` å·²è‡ªåŠ¨åŒ…å« QuantBox ä¾èµ–ï¼š

```toml
dependencies = [
    # ... å…¶ä»–ä¾èµ–
    "quantbox @ file:///Users/huchen/Projects/quantbox",
    "pymongo>=4.0,<5.0",
    "motor>=3.3.0",
]
```

ä½¿ç”¨ uv å®‰è£…ï¼š

```bash
uv sync
```

### 2. MongoDB è®¾ç½®

QuantBox éœ€è¦ MongoDB ä½œä¸ºæœ¬åœ°æ•°æ®å­˜å‚¨ï¼š

```bash
# ä½¿ç”¨ Docker å¯åŠ¨ MongoDB
docker run -d \
  --name quantbox-mongo \
  -p 27017:27017 \
  -v mongo_data:/data/db \
  mongo:latest
```

### 3. é…ç½®æ–‡ä»¶

QuantBox ä¼šè‡ªåŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶ `~/.quantbox/settings/config.toml`ï¼š

```toml
# Tushare Pro API é…ç½®
[TSPRO]
token = "your_tushare_token_here"

# MongoDB æ•°æ®åº“é…ç½®
[MONGODB]
uri = "mongodb://localhost:27017"

# æ˜é‡‘é‡åŒ– API é…ç½®ï¼ˆå¯é€‰ï¼‰
[GM]
token = ""
```

## ğŸ’» ä½¿ç”¨æŒ‡å—

### åŸºæœ¬ä½¿ç”¨

```python
from src.cherryquant.adapters.data_adapter.history_data_manager import HistoryDataManager

# å¯ç”¨ QuantBox é›†æˆçš„ç®¡ç†å™¨
manager = HistoryDataManager(
    enable_quantbox=True,    # å¯ç”¨ QuantBox
    use_async=True,         # ä½¿ç”¨å¼‚æ­¥æ¨¡å¼
    enable_dual_write=False # åŒå†™æœºåˆ¶ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®å¼€å¯ï¼‰
)

# è·å–å†å²æ•°æ®ï¼ˆè‡ªåŠ¨ä½¿ç”¨ QuantBox ä¼˜åŒ–ï¼‰
df = await manager.get_historical_data(
    symbol="rb2501",
    exchange="SHFE",
    interval="1d",
    start_date="2024-01-01",
    end_date="2024-01-31",
    prefer_quantbox=True    # ä¼˜å…ˆä½¿ç”¨ QuantBox
)
```

### é«˜çº§åŠŸèƒ½

#### æ‰¹é‡æ•°æ®è·å–

```python
requests = [
    {
        "symbol": "rb2501",
        "exchange": "SHFE",
        "interval": "1d",
        "start_date": "2024-01-01",
        "end_date": "2024-01-10"
    },
    {
        "symbol": "cu2501",
        "exchange": "SHFE",
        "interval": "1d",
        "start_date": "2024-01-01",
        "end_date": "2024-01-10"
    }
]

results = await manager.batch_get_historical_data(requests)
```

#### åˆçº¦ä¿¡æ¯æŸ¥è¯¢

```python
# è·å–åˆçº¦è¯¦ç»†ä¿¡æ¯
contract_info = await manager.get_contract_info("rb2501", "SHFE")
print(f"åˆçº¦åç§°: {contract_info.get('name')}")
print(f"åˆçº¦ä¹˜æ•°: {contract_info.get('multiplier')}")
```

#### äº¤æ˜“æ—¥å†æŸ¥è¯¢

```python
from datetime import datetime

# æ£€æŸ¥æ˜¯å¦ä¸ºäº¤æ˜“æ—¥
is_trading = await manager.is_trading_day(
    datetime(2024, 1, 15),
    exchange="SHFE"
)
```

### ç¼“å­˜ç®¡ç†

```python
# è·å–ç¼“å­˜ä¿¡æ¯
cache_info = manager.get_cache_info()
print(f"ç¼“å­˜å¤§å°: {cache_info['cache_size']}")
print(f"QuantBox å·²å¯ç”¨: {cache_info['quantbox_enabled']}")

# æ¸…ç©ºç¼“å­˜
manager.clear_all_caches()
```

### ç³»ç»ŸçŠ¶æ€ç›‘æ§

```python
# è·å–ç³»ç»ŸçŠ¶æ€
status = manager.get_system_status()
print(f"QuantBox é›†æˆ: {status['quantbox_integration']}")
print(f"æ•°æ®åº“è¿æ¥: {status['database_connections']}")
```

## ğŸ› ï¸ é…ç½®é€‰é¡¹

### HistoryDataManager å‚æ•°

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `enable_quantbox` | bool | True | æ˜¯å¦å¯ç”¨ QuantBox é›†æˆ |
| `use_async` | bool | True | æ˜¯å¦ä½¿ç”¨å¼‚æ­¥æ“ä½œ |
| `enable_dual_write` | bool | False | æ˜¯å¦å¯ç”¨åŒå†™æœºåˆ¶ |
| `cache_size` | int | 1000 | æœ¬åœ°ç¼“å­˜å¤§å° |
| `cache_ttl` | int | 3600 | ç¼“å­˜TTLï¼ˆç§’ï¼‰ |

### æ•°æ®æºä¼˜å…ˆçº§

1. **QuantBox æœ¬åœ°ç¼“å­˜** â†’ æœ€å¿«
2. **QuantBox MongoDB** â†’ æœ¬åœ°æ•°æ®åº“
3. **QuantBox è¿œç¨‹API** â†’ Tushare/æ˜é‡‘é‡åŒ–
4. **ä¼ ç»Ÿ PostgreSQL/Redis** â†’ åå¤‡ç³»ç»Ÿ

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### æ•°æ®è·å–æ€§èƒ½

| æ“ä½œç±»å‹ | ä¼ ç»Ÿå®ç° | QuantBox é›†æˆ | æ€§èƒ½æå‡ |
|----------|----------|----------------|----------|
| å•æ¬¡æ•°æ®è·å– | ~100ms | ~20ms | **5x** |
| æ‰¹é‡æ•°æ®è·å– | ~1000ms | ~50ms | **20x** |
| ç¼“å­˜å‘½ä¸­ | ~50ms | ~2ms | **25x** |
| ç¼“å­˜æœªå‘½ä¸­ | ~100ms | ~10ms | **10x** |

### å†…å­˜ä½¿ç”¨

| æŒ‡æ ‡ | ä¼ ç»Ÿå®ç° | QuantBox é›†æˆ | ä¼˜åŒ–æ•ˆæœ |
|------|----------|----------------|----------|
| åŸºç¡€å†…å­˜ | ~200MB | ~150MB | **-25%** |
| ç¼“å­˜å†…å­˜ | ~50MB | ~30MB | **-40%** |
| æ€»ä½“å†…å­˜ | ~250MB | ~180MB | **-28%** |

## ğŸ§ª æµ‹è¯•

### è¿è¡Œé›†æˆæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰é›†æˆæµ‹è¯•
uv run pytest tests/integration/test_quantbox_integration.py -v

# è¿è¡Œæ¼”ç¤º
python examples/quantbox_integration_demo.py
```

### æµ‹è¯•è¦†ç›–

- âœ… é€‚é…å™¨åˆå§‹åŒ–å’Œè¿æ¥
- âœ… æ•°æ®æ ¼å¼è½¬æ¢
- âœ… ç¼“å­˜ç®¡ç†
- âœ… æ‰¹é‡æ“ä½œ
- âœ… é”™è¯¯å¤„ç†å’Œå›é€€æœºåˆ¶
- âœ… ç³»ç»ŸçŠ¶æ€ç›‘æ§

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ•°æ®æºé…ç½®

ç¡®ä¿æ­£ç¡®é…ç½® Tushare Tokenï¼š
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
export TUSHARE_TOKEN="your_token_here"

# æˆ–åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®
# ~/.quantbox/settings/config.toml
[TSPRO]
token = "your_tushare_token_here"
```

### 2. MongoDB è¿æ¥

ç¡®ä¿ MongoDB æœåŠ¡æ­£åœ¨è¿è¡Œï¼š
```bash
# æ£€æŸ¥ MongoDB çŠ¶æ€
docker ps | grep mongo

# å¯åŠ¨ MongoDB
docker run -d -p 27017:27017 mongo:latest
```

### 3. å¼‚æ­¥æ“ä½œ

åœ¨å¼‚æ­¥ç¯å¢ƒä¸­ä½¿ç”¨ï¼Œé¿å…é˜»å¡ï¼š
```python
# âœ… æ­£ç¡®
async def get_data():
    return await manager.get_historical_data(...)

# âŒ é”™è¯¯
def get_data():
    return asyncio.run(manager.get_historical_data(...))  # åœ¨å¼‚æ­¥ç¯å¢ƒä¸­ä¼šæŠ¥é”™
```

### 4. é”™è¯¯å¤„ç†

ç³»ç»Ÿå…·æœ‰å®Œæ•´çš„å®¹é”™æœºåˆ¶ï¼š
- QuantBox å¤±è´¥ â†’ è‡ªåŠ¨å›é€€åˆ°ä¼ ç»Ÿç³»ç»Ÿ
- ç½‘ç»œé—®é¢˜ â†’ ä½¿ç”¨ç¼“å­˜æ•°æ®
- æ•°æ®æ ¼å¼é”™è¯¯ â†’ è‡ªåŠ¨è½¬æ¢å’Œæ¸…ç†

## ğŸ”® æœªæ¥è®¡åˆ’

### çŸ­æœŸç›®æ ‡ (v0.1.1)
- [ ] å®Œå–„ TimeFrameDataManager é›†æˆ
- [ ] æ·»åŠ æ›´å¤šæ•°æ®æºæ”¯æŒ
- [ ] ä¼˜åŒ–ç¼“å­˜ç­–ç•¥
- [ ] å¢åŠ æ€§èƒ½ç›‘æ§

### ä¸­æœŸç›®æ ‡ (v0.2.0)
- [ ] å®æ—¶æ•°æ®æµé›†æˆ
- [ ] æœºå™¨å­¦ä¹ æ•°æ®é¢„å¤„ç†
- [ ] åˆ†å¸ƒå¼ç¼“å­˜æ”¯æŒ
- [ ] æ•°æ®è´¨é‡ç›‘æ§

### é•¿æœŸç›®æ ‡ (v1.0.0)
- [ ] å®Œå…¨æ›¿æ¢ä¼ ç»Ÿæ•°æ®å±‚
- [ ] å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»
- [ ] äº‘åŸç”Ÿéƒ¨ç½²æ”¯æŒ
- [ ] å®Œæ•´çš„æ•°æ®è¡€ç¼˜è¿½è¸ª

## ğŸ“ æ”¯æŒå’Œåé¦ˆ

å¦‚æœåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. **æ£€æŸ¥æ—¥å¿—**ï¼šæŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè°ƒè¯•ä¿¡æ¯
2. **è¿è¡Œæµ‹è¯•**ï¼šç¡®è®¤é›†æˆç¯å¢ƒæ­£å¸¸å·¥ä½œ
3. **æŸ¥çœ‹æ–‡æ¡£**ï¼šå‚è€ƒ [QuantBox å®˜æ–¹æ–‡æ¡£](../quantbox/README.md)
4. **æäº¤ Issue**ï¼šåœ¨é¡¹ç›®ä¸­åˆ›å»ºé—®é¢˜æè¿°

## ğŸ“ æ›´æ–°æ—¥å¿—

### v0.1.0 (2025-11-12)
- âœ¨ é¦–æ¬¡é›†æˆ QuantBox
- âœ… å¼‚æ­¥é«˜æ€§èƒ½æ•°æ®æ“ä½œ
- âœ… æ™ºèƒ½ç¼“å­˜é¢„çƒ­ç³»ç»Ÿ
- âœ… æ‰¹é‡æ•°æ®æ“ä½œæ”¯æŒ
- âœ… å®Œæ•´çš„å®¹é”™æœºåˆ¶
- âœ… 100% å‘åå…¼å®¹

---

**Made with â¤ï¸ by CherryQuant Team**